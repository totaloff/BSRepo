jQuery(document).ready(function(a){a.fn.init_addon_totals=function(){function b(){var b=a(".product-type-grouped"),c=0,d=0;return b.length&&(b.find(".group_table tr.product").each(function(){0<a(this).find(".input-text.qty").val()&&(a(this).find(".entry-summary .subscription-details").length?c++:d++)}),c>0&&d>0)?!0:!1}function c(){var b=a(".product-type-grouped"),c=!1;return b.length&&b.find(".group_table tr.product").each(function(){return 0<a(this).find(".input-text.qty").val()&&a(this).find(".entry-summary .subscription-details").length?(c=!0,!1):void 0}),c}var d=a(this),e="";a(this).on("click",".reset_variations",function(){a.each(d.find(".product-addon"),function(){var b=a(this).find(".addon");(b.is(":checkbox")||b.is(":radio"))&&b.prop("checked",!1),b.is("select")&&b.prop("selectedIndex",0),(b.is(":text")||b.is("textarea")||b.is('input[type="number"]')||b.is('input[type="file"]'))&&b.val("")}),d.trigger("woocommerce-product-addons-update")}),a(this).on("mouseup","input[type=number]",function(b){a(this).trigger("woocommerce-product-addons-update")}),a(this).on("keyup change",".product-addon input, .product-addon textarea",function(){if(a(this).attr("maxlength")>0){var b=a(this).val(),c=a(this).attr("maxlength")-b.length;a(this).next(".chars_remaining").find("span").text(c)}}),a(this).find(" .addon-custom, .addon-custom-textarea").each(function(){a(this).attr("maxlength")>0&&a(this).after('<small class="chars_remaining"><span>'+a(this).attr("maxlength")+"</span> "+woocommerce_addons_params.i18n_remaining+"</small>")}),a(this).on("change",".product-addon input, .product-addon textarea, .product-addon select, input.qty",function(){a(this).trigger("woocommerce-product-addons-update")}),a(this).on("found_variation",function(b,c){var d=a(this),f=d.find("#product-addons-total");"undefined"!=typeof c.display_price?f.data("price",c.display_price):a(c.price_html).find(".amount:last").size()&&(product_price=a(c.price_html).find(".amount:last").text(),product_price=product_price.replace(woocommerce_addons_params.currency_format_symbol,""),product_price=product_price.replace(woocommerce_addons_params.currency_format_thousand_sep,""),product_price=product_price.replace(woocommerce_addons_params.currency_format_decimal_sep,"."),product_price=product_price.replace(/[^0-9\.]/g,""),product_price=parseFloat(product_price),f.data("price",product_price)),e=c,d.trigger("woocommerce-product-addons-update")});var f=a("#credit_called");a(f).on("keyup",function(){d.trigger("woocommerce-product-addons-update")}),a(this).on("woocommerce-product-addons-update",function(){var g=0,h=d.find("#product-addons-total"),i=h.data("price"),j=h.data("type"),k="object"==typeof e?e.variation_id:h.data("product-id"),l=d.find(".quantity .qty").val(),m=h.data("raw-price"),n=(h.data("tax-mode"),h.data("tax-display-mode"),0);if(""===i&&f.length&&0<f.val()&&(i=f.val()),d.find(".addon").each(function(){var b=0,c=0;a(this).is(".addon-custom-price")?b=a(this).val():a(this).is(".addon-input_multiplier")?(isNaN(a(this).val())||""==a(this).val()?(a(this).val(""),a(this).closest("p").find(".addon-alert").show()):(""!=a(this).val()&&a(this).val(Math.ceil(a(this).val())),a(this).closest("p").find(".addon-alert").hide()),b=a(this).data("price")*a(this).val(),c=a(this).data("raw-price")*a(this).val()):a(this).is(".addon-checkbox, .addon-radio")?a(this).is(":checked")&&(b=a(this).data("price"),c=a(this).data("raw-price")):a(this).is(".addon-select")?a(this).val()&&(b=a(this).find("option:selected").data("price"),c=a(this).find("option:selected").data("raw-price")):a(this).val()&&(b=a(this).data("price"),c=a(this).data("raw-price")),b||(b=0),c||(c=0),g=parseFloat(g)+parseFloat(b),n=parseFloat(n)+parseFloat(c)}),h.data("addons-price",g),h.data("addons-raw-price",n),d.find("input.qty").size()){var l=0;d.find("input.qty").each(function(){l+=parseFloat(a(this).val())})}else var l=1;if(g>0&&l>0){var o,p;g=parseFloat(g*l),n=parseFloat(n*l);var q=accounting.formatMoney(g,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format});if("undefined"!=typeof i){o=parseFloat(i*l);var r=accounting.formatMoney(o+g,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format})}p=parseFloat(m*l);var s=(accounting.formatMoney(p+n,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format}),!1);a(".entry-summary .subscription-details").length&&(d.hasClass("bundle_data")||(s=a(".entry-summary .subscription-details").clone().wrap("<p>").parent().html())),"grouped"===j?s&&!b()&&c()&&(q+=s,r&&(r+=s)):s&&(q+=s,r&&(r+=s));var t='<dl class="product-addon-totals"><dt>'+woocommerce_addons_params.i18n_addon_total+'</dt><dd><strong><span class="amount">'+q+"</span></strong></dd>";if(r&&"1"==h.data("show-grand-total")){var u="";if(!woocommerce_addons_params.price_display_suffix)return t=t+"<dt>"+woocommerce_addons_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+r+"</span></strong></dd></dl>",h.html(t),void d.trigger("updated_addons");if(!1==woocommerce_addons_params.price_display_suffix.indexOf("{price_including_tax}")>-1&&!1==woocommerce_addons_params.price_display_suffix.indexOf("{price_excluding_tax}")>-1)return t=t+"<dt>"+woocommerce_addons_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+r+"</span> "+woocommerce_addons_params.price_display_suffix+"</strong></dd></dl>",h.html(t),void d.trigger("updated_addons");a.ajax({type:"POST",url:woocommerce_addons_params.ajax_url,data:{action:"wc_product_addons_calculate_tax",product_id:k,add_on_total:g,add_on_total_raw:n,qty:l},success:function(a){if("SUCCESS"==a.result){u='<small class="woocommerce-price-suffix">'+woocommerce_addons_params.price_display_suffix+"</small>";var b=accounting.formatMoney(a.price_including_tax,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format}),c=accounting.formatMoney(a.price_excluding_tax,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format});u=u.replace("{price_including_tax}",b),u=u.replace("{price_excluding_tax}",c),t=t+"<dt>"+woocommerce_addons_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+r+"</span> "+u+" </strong></dd></dl>",h.html(t),d.trigger("updated_addons")}else t=t+"<dt>"+woocommerce_addons_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+r+"</span></strong></dd></dl>",h.html(t),d.trigger("updated_addons")},error:function(){t=t+"<dt>"+woocommerce_addons_params.i18n_grand_total+'</dt><dd><strong><span class="amount">'+r+"</span></strong></dd></dl>",h.html(t),d.trigger("updated_addons")}})}else h.empty(),d.trigger("updated_addons")}else h.empty(),d.trigger("updated_addons")}),a(this).find(".addon-custom, .addon-custom-textarea, .product-addon input, .product-addon textarea, .product-addon select, input.qty").change(),a(this).find(".variations select").change()},a("body").on("quick-view-displayed",function(){a(this).find(".cart:not(.cart_group)").each(function(){a(this).init_addon_totals()})}),a("body .component").on("wc-composite-component-loaded",function(){a(this).find(".cart").each(function(){a(this).init_addon_totals()})}),a("body").find(".cart:not(.cart_group)").each(function(){a(this).init_addon_totals()})});